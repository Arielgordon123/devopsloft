---
dist: xenial

language: python

python:
  - "3.6"

services:
  - docker

env:
  - mysql_root_username=root mysql_root_password='12345'

before_install:
  - sudo apt-get install -y libmysqlclient-dev

addons:
  apt:
    update: true

install:
  - pip install -r requirements-dev.txt
  - docker build -t devopsloft/mysql db_s2i/.
  - docker build -t devopsloft/devopsloft web_s2i/.

before_script:
  - docker network create devopsloft_network
  - docker run -d --network devopsloft_network -p 3306:3306 --name db devopsloft/mysql
  - docker run -d --network devopsloft_network -p 80:80 --name web devopsloft/devopsloft
  - docker exec -it db bash -c 'while ! mysqladmin ping --silent; do sleep 3; done'

script:
  - flake8 --exclude venv .
  - tests/is_table_empty.py
  - tests/basic_http_get_test.py
